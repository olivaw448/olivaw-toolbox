<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat export parser</title>
  <link rel="icon" href="https://img.icons8.com/?size=100&id=986&format=png&color=000000" type="image/x-icon">
  <style>
    :root {
      --bg-dark: #343541;
      --text-dark: #ffffff;
      --border-dark: #555;
      --bg-light: #ffffff;
      --text-light: #000000;
      --border-light: #ccc;
      --dark-drop-bg: #444654;
      --dark-output-bg: #444654;
      --light-drop-bg: #f0f0f0;
      --light-drop-selected: #e5e5e5;
      --light-output-bg: #f0f0f0;
      --btn-bg: #888;
      --btn-bg-hover: #666;
      --btn-dark-pressed: #333;
      --btn-light-pressed: #bbb;
      --export-btn-bg: #a6a6a6;
      --export-btn-selected: #999999;
    }
    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-dark);
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      position: relative;
    }
    .language-selector {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10000;
      display: flex;
      gap: 8px;
    }
    .language-selector label {
      display: inline-block;
      padding: 4px 8px;
      font-size: 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      background-color: #a6a6a6;
      color: #fff;
      border: none;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    .language-selector label.selected {
      background-color: #999999;
    }
    .language-selector input[type="radio"] {
      display: none;
    }
    .container {
      text-align: center;
      max-width: 90%;
      padding: 20px;
      box-sizing: border-box;
      margin-top: 80px;
    }
    h2 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    p.description {
      font-size: 1rem;
      margin-bottom: 10px;
      color: #aaa;
    }
    #export-type-bar {
      margin-bottom: 20px;
    }
    #export-type-bar button {
      padding: 6px 12px;
      font-size: 0.9rem;
      border: none;
      border-radius: 4px;
      background-color: var(--export-btn-bg);
      color: var(--text-dark);
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-right: 8px;
    }
    #export-type-bar button.selected {
      background-color: var(--export-btn-selected);
    }
    hr.separator {
      border: none;
      border-top: 1px solid #888;
      margin: 20px 0;
    }
    #search-container,
    #search-options,
    #author-option {
      margin-bottom: 20px;
      text-align: center;
    }
    #search-label {
      font-size: 1rem;
      margin-bottom: 10px;
      display: block;
    }
    #search-word {
      padding: 8px;
      font-size: 1rem;
      border: 1px solid #888;
      border-radius: 4px;
      width: 60%;
      max-width: 300px;
    }
    #drop-area {
      border: 2px dashed var(--border-dark);
      padding: 20px;
      margin: 20px 0;
      cursor: pointer;
      background-color: var(--dark-drop-bg);
      color: var(--text-dark);
      border-radius: 8px;
      transition: background-color 0.3s ease;
      position: relative;
    }
    #drop-text {
      margin: 0;
      font-size: 1rem;
    }
    /* Скрытый input для файла */
    #file-input {
      display: none;
    }
    #copy-btn,
    #download-btn {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 1rem;
      background-color: var(--btn-bg);
      color: var(--text-dark);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #copy-btn:hover,
    #download-btn:hover {
      background-color: var(--btn-bg-hover);
    }
    #output {
      white-space: pre-wrap;
      text-align: left;
      background-color: var(--dark-output-bg);
      padding: 10px;
      border: 1px solid var(--border-dark);
      margin-top: 10px;
      border-radius: 4px;
      overflow: auto;
      display: none;
      max-width: 80vw;
      overflow-wrap: break-word;
    }
    #top-right-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      color: var(--text-dark);
    }
    #top-right-btn:hover {
      text-decoration: underline;
    }
    #theme-toggle-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: var(--btn-bg);
      border: none;
      padding: 5px 10px;
      font-size: 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      color: var(--text-dark);
      transition: background-color 0.3s ease;
    }
    #theme-toggle-btn:hover {
      background-color: var(--btn-bg-hover);
    }
    .light-theme {
      background-color: var(--bg-light);
      color: var(--text-light);
    }
    .light-theme #drop-area {
      background-color: var(--light-drop-bg);
      border: 2px dashed var(--border-light);
      color: var(--text-light);
    }
    .light-theme #output {
      background-color: var(--light-output-bg);
      border: 1px solid var(--border-light);
      color: var(--text-light);
    }
    .light-theme #copy-btn,
    .light-theme #download-btn {
      background-color: #ccc;
      color: var(--text-light);
    }
    .light-theme #top-right-btn {
      color: var(--text-light);
    }
    .light-theme #theme-toggle-btn {
      background-color: #ccc;
      color: var(--text-light);
    }
    @media (max-width: 600px) {
      h2 {
        font-size: 2rem;
      }
      #search-word {
        width: 80%;
        max-width: 80%;
      }
      #copy-btn,
      #download-btn,
      #theme-toggle-btn {
        font-size: 0.8rem;
        padding: 5px 10px;
      }
    }
    #progress-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      display: none;
      justify-content: center;
      align-items: center;
    }
    #progress-container {
      background: #222;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      color: #fff;
      width: 80%;
      max-width: 300px;
    }
    #progress-bar {
      width: 100%;
      height: 20px;
      margin-bottom: 10px;
      background: #444;
      border-radius: 4px;
      overflow: hidden;
    }
    #progress-bar-inner {
      height: 100%;
      width: 0%;
      background: #10a37f;
      transition: width 0.2s ease;
    }
    #cancel-btn {
      background: var(--btn-bg);
      color: var(--text-dark);
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    #cancel-btn:hover {
      background-color: var(--btn-bg-hover);
    }
    .light-theme #cancel-btn {
      background: #ccc;
      color: var(--text-light);
    }
  </style>
</head>
<body>
  <!-- Global Variables -->
  <script>
    var currentLanguage = localStorage.getItem("language") || "en";
    var currentExportType = localStorage.getItem("exportType") || "telegram";
  </script>
  
  <!-- Language Selector -->
  <div class="language-selector">
    <label data-lang="en">
      <input type="radio" name="language" value="en">
      <span>English</span>
    </label>
    <label data-lang="ru">
      <input type="radio" name="language" value="ru">
      <span>Русский</span>
    </label>
    <label data-lang="ua">
      <input type="radio" name="language" value="ua">
      <span>Українська</span>
    </label>
  </div>
  
  <button id="top-right-btn" onclick="window.location.href='https://olivaw448.github.io/somepages/'">olivaw448-tools</button>
  <button id="theme-toggle-btn">Light mode</button>
  <div class="container">
    <h2 id="title">Chat export parser</h2>
    <p class="description" id="description">Sample text</p>
    <div id="export-type-bar">
      <button id="btn-telegram" data-type="telegram" class="selected">Telegram</button>
      <button id="btn-whatsapp" data-type="whatsapp">WhatsApp (coming soon)</button>
    </div>
    <hr class="separator" />
    <div id="search-container">
      <label for="search-word" id="search-label">Enter a search word at the beginning of each message:</label>
      <input type="text" id="search-word" value="">
    </div>
    <div id="search-options">
      <label>
        <input type="checkbox" id="search-inside" />
        <span id="search-inside-label">Search string inside messages</span>
      </label>
    </div>
    <div id="author-option">
      <label>
        <input type="checkbox" id="show-author" />
        <span id="show-author-label">Show message author</span>
      </label>
    </div>
    <div id="date-range-option">
      <label>
        <input type="checkbox" id="date-range-checkbox" />
        <span id="date-range-label">Date range</span>
      </label>
    </div>
    <div id="date-range-fields" style="display:none;">
      <input type="date" id="date-from" placeholder="From">
      <span>-</span>
      <input type="date" id="date-to" placeholder="To">
    </div>
    <div id="drop-area">
      <p id="drop-text">Loading export script...</p>
      <input type="file" id="file-input" style="display:none;">
    </div>
    <button id="copy-btn" style="display:none;">Copy</button>
    <button id="download-btn" style="display:none;">Download result</button>
    <div id="output"></div>
  </div>
  
  <div id="progress-overlay">
    <div id="progress-container">
      <div id="progress-bar">
        <div id="progress-bar-inner"></div>
      </div>
      <button id="cancel-btn">Cancel</button>
    </div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script>
    const exportTypeTranslations = {
      telegram: {
        en: {
          title: "Telegram Chat Parser",
          description: "Telegram Sample text",
          searchLabel: "Enter a search word at the beginning of each message:",
          searchInsideLabel: "Search string inside messages",
          showAuthorLabel: "Show message author"
        },
        ru: {
          title: "Парсер Telegram Чата",
          description: "Пример текста для Telegram",
          searchLabel: "Введите слово для поиска в начале каждого сообщения:",
          searchInsideLabel: "Искать строку внутри сообщений",
          showAuthorLabel: "Показывать автора сообщения"
        },
        ua: {
          title: "Парсер Telegram чату",
          description: "Приклад тексту для Telegram",
          searchLabel: "Введіть слово для пошуку на початку кожного повідомлення:",
          searchInsideLabel: "Шукати рядок усередині повідомлень",
          showAuthorLabel: "Показувати автора повідомлення"
        }
      },
      whatsapp: {
        en: {
          title: "WhatsApp Chat Parser",
          description: "WhatsApp Sample text",
          searchLabel: "Enter a search word at the beginning of each message:",
          searchInsideLabel: "Search string inside messages",
          showAuthorLabel: "Show message author"
        },
        ru: {
          title: "Парсер WhatsApp Чата",
          description: "Пример текста для WhatsApp",
          searchLabel: "Введите слово для поиска в начале каждого сообщения:",
          searchInsideLabel: "Искать строку внутри сообщений",
          showAuthorLabel: "Показывать автора сообщения"
        },
        ua: {
          title: "Парсер WhatsApp чату",
          description: "Приклад тексту для WhatsApp",
          searchLabel: "Введіть слово для пошуку на початку кожного повідомлення:",
          searchInsideLabel: "Шукати рядок усередині повідомлень",
          showAuthorLabel: "Показувати автора повідомлення"
        }
      }
    };
    
    function updateIndexInterface() {
      const texts = exportTypeTranslations[currentExportType][currentLanguage];
      document.getElementById("title").textContent = texts.title;
      document.getElementById("description").textContent = texts.description;
      document.getElementById("search-label").textContent = texts.searchLabel;
      document.getElementById("search-inside-label").textContent = texts.searchInsideLabel;
      document.getElementById("show-author-label").textContent = texts.showAuthorLabel;
      
      // Обновляем текст кнопок экспорта (пример)
      if (currentExportType === "telegram") {
        document.getElementById("btn-telegram").textContent = texts.title.split(" ")[0];
        document.getElementById("btn-whatsapp").textContent = exportTypeTranslations.whatsapp[currentLanguage].title.split(" ")[0];
      } else {
        document.getElementById("btn-telegram").textContent = exportTypeTranslations.telegram[currentLanguage].title.split(" ")[0];
        document.getElementById("btn-whatsapp").textContent = texts.title.split(" ")[0];
      }
      
      updateLanguageSelectorUI();
      
      // Обновляем drop text, если соответствующая функция экспортного скрипта загружена
      if (currentExportType === "telegram" && typeof window.getTelegramDropText === "function") {
        document.getElementById("drop-text").textContent = window.getTelegramDropText();
      } else if (currentExportType === "whatsapp" && typeof window.getWhatsappDropText === "function") {
        document.getElementById("drop-text").textContent = window.getWhatsappDropText();
      }
    }
    
    function updateLanguageSelectorUI() {
      document.querySelectorAll('.language-selector label').forEach(label => {
        const input = label.querySelector('input[name="language"]');
        const span = label.querySelector('span');
        if (input.value === currentLanguage) {
          span.textContent = "> " + (input.value === "en" ? "English" : input.value === "ru" ? "Русский" : "Українська");
          label.classList.add("selected");
          input.checked = true;
        } else {
          span.textContent = (input.value === "en" ? "English" : input.value === "ru" ? "Русский" : "Українська");
          label.classList.remove("selected");
        }
      });
    }
    
    document.querySelectorAll('input[name="language"]').forEach(radio => {
      radio.addEventListener("change", function() {
        currentLanguage = this.value;
        localStorage.setItem("language", currentLanguage);
        updateIndexInterface();
        if (typeof window.updateInterface === "function") {
          window.updateInterface();
        }
      });
    });
    
    function updateExportButtons() {
      document.querySelectorAll("#export-type-bar button").forEach(btn => {
        if (btn.dataset.type === currentExportType) {
          btn.classList.add("selected");
        } else {
          btn.classList.remove("selected");
        }
      });
      resetFileInput();
    }
    
    document.querySelectorAll("#export-type-bar button").forEach(btn => {
      btn.addEventListener("click", function() {
        currentExportType = this.dataset.type;
        localStorage.setItem("exportType", currentExportType);
        updateExportButtons();
        loadExportScript(currentExportType + ".js");
        updateIndexInterface();
      });
    });
    
    function resetFileInput() {
      const dropArea = document.getElementById("drop-area");
      const oldInput = document.getElementById("file-input");
      if (oldInput) { oldInput.remove(); }
      const newInput = document.createElement("input");
      newInput.type = "file";
      newInput.id = "file-input";
      newInput.style.display = "none";
      dropArea.appendChild(newInput);
    }
    
    function loadExportScript(scriptName) {
      let currentExportScript = document.getElementById("current-export-script");
      if (currentExportScript) { currentExportScript.remove(); }
      currentExportScript = document.createElement("script");
      currentExportScript.src = scriptName;
      currentExportScript.id = "current-export-script";
      currentExportScript.onload = function() {
        if (currentExportType === "telegram" && typeof window.getTelegramDropText === "function") {
          document.getElementById("drop-text").textContent = window.getTelegramDropText();
        } else if (currentExportType === "whatsapp" && typeof window.getWhatsappDropText === "function") {
          document.getElementById("drop-text").textContent = window.getWhatsappDropText();
        }
      };
      document.body.appendChild(currentExportScript);
    }
    
    updateIndexInterface();
    updateExportButtons();
    loadExportScript(currentExportType + ".js");
  </script>
</body>
</html>
